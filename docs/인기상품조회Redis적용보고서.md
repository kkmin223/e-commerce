## 인기 상품 조회 시스템 Redis 적용 보고서

---

### 1. **아키텍처 개요**
- **실시간 주문 집계** → **3일 데이터 통합** → **캐싱** → **일일 백업**의 4단계 프로세스

---

### 2. **핵심 구현 사항**

#### 2.1 실시간 주문 데이터 수집
- **기술**: Redis Sorted Set (`ZINCRBY`)
- **동작 시점**:
    - 주문 트랜잭션 완료 후 (`@TransactionalEventListener AFTER_COMMIT`)
- **데이터 구조**:
  ```bash
  KEY: PRODUCT:DAILY:{날짜} (예: PRODUCT:DAILY:20250516)
  VALUE: {상품ID: 주문수량} (ZSET)
  ```
- **TTL** : 74시간(3일 + 2시간)으로 설정하여 3일 이후에 자동으로 사라지게 설정

#### 2.2 인기 상품 집계
- **집계 범위**: 최근 3일 데이터
- **연산 방식**: ZUNIONSTORE를 사용하여 최근 3일간 주문 데이터 집계
- **결과 활용**: 상위 5개 상품 ID 추출 → API 응답

#### 2.3 캐싱 전략
- **저장 대상**: 인기 상품 조회 결과
- **TTL**: 5분간 집계한 인기 상품 조회 결과 캐싱

#### 2.4 데이터 백업
- **백업 주기**: 매일 00:10
- **백업 방식**:
    1. 전일 기준 Redis Sorted Set 전체 조회
    2. RDB 테이블에 배치 인서트
---

### 3. **장점**
1. **집계 쿼리 제거**
2. **빠른 순위 반영** : 기존에는 집계 쿼리를 최소화 하기 위해서 인기 판매 상품을 1일 마다 집계하여 캐싱하였는데, Redis를 사용하여 최대 5분이내에 순위에 반영되도록 변경
3. **데이터 안정성**: 이중화 백업 시스템

---

### 4. **데이터 흐름도**
```
[주문] → (트랜잭션 커밋) → [Redis 집계]  
                           ↘→ [3일 통합] → [캐시 저장] → [API 제공]  
                           ↘→ [00:10 백업] → [RDB 영구 저장]  
```
